import pandas as pd
import numpy as np
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import roc_auc_score

df = pd.read_csv("C:\\Users\\acer21\\Downloads\\day20_integration.csv")
if "converted" not in df.columns:
    df["converted"] = [1, 0, 1, 0]
df["is_mobile"] = (df["device_type"] == "mobile").astype(int)
scaler = StandardScaler()
df[["pages_viewed", "session_minutes", "basket_value"]] = scaler.fit_transform(df[["pages_viewed", "session_minutes", "basket_value"]])

df["pages_per_min"] = df["pages_viewed"] / (df["session_minutes"] + 1e-3)
df["is_mobile_high_spend"] = (df["is_mobile"] & (df["basket_value"] > df["basket_value"].median())).astype(int)

base_features = ["pages_viewed", "session_minutes", "basket_value"]
engineered_features = base_features + ["pages_per_min", "is_mobile_high_spend"]

y = df["converted"]
clf_base = LogisticRegression().fit(df[base_features], y)
base_auc = roc_auc_score(y, clf_base.predict_proba(df[base_features])[:, 1])
clf_eng = LogisticRegression().fit(df[engineered_features], y)
eng_auc = roc_auc_score(y, clf_eng.predict_proba(df[engineered_features])[:, 1])
print(f"Baseline AUC: {base_auc:.3f}")
print(f"Engineered AUC: {eng_auc:.3f}")
